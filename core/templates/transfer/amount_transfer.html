{% extends "auth_base.html" %}
{% load static %}
{% load humanize %}

{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

{% block content %}

    <!-- Dashboard Section start -->
    <section class="dashboard-section body-collapse pay step step-2">
        <div class="overlay pt-120">
            <div class="container-fruid">
                <div class="main-content">
                    <div class="head-area d-flex align-items-center justify-content-between">
                        <h4>{% translate "Make a Payment" %}</h4>
                        <div class="icon-area">
                            <img src="{% static 'assets1/images/icon/support-icon.png' %}" alt="icon">
                        </div>
                    </div>
                    <div class="choose-recipient">
                        <div class="step-area">
                            <span class="mdr">{% translate "Step 2 of 3" %}</span>
                            <h5>{% translate "Set Amount of transfer" %}</h5>
                        </div>
                        <div class="user-select">
                            <div class="single-user">
                                <div class="left d-flex align-items-center">
                                    <div class="img-area">
                                    <!-- <img src="{{ account.user.kyc.image.url }}" alt="image"> -->
                                    <img src="{{ account.user.kyc.image.url }}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;"  alt="image">

                                </div>
                                <div class="text-area">
                                    <p>{{ account.user.kyc.full_name|title }}</p>
                                    <span class="mdr"><b>{{ account.account_number }}</b></span> <br>
                                    <span class="mdr">{{ account.user.email }}</span>
                                </div>
                                </div>
                                <div class="right">
                                    
                                    <a href="{% url 'core:search-account' %}">
                                        <i class="icon-h-edit"></i>
                                        Edit
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <form action="{% url 'core:amount-transfer-process' account.account_number %}" method="POST">
                        {% csrf_token %}
                        <div class="send-banance">
                            <span class="mdr">{% translate "You Send" %}</span>
                            <div class="input-area">
                                <input class="xxlr" onkeyup="CalculateBalance()" placeholder="{{ request.user.account.account_balance|intcomma }}" type="number" name='amount_send' id="amount_send">
                            </div>
                            <p>{% translate "Available Balance" %}<b>${{ request.user.account.account_balance|intcomma }}</b></p>
                            <b id="new_balance"></b>
                            <b class="text-danger" id="error-div"></b>
                        </div>


                        <div class="send-banance pt-0 mt-0">
                            <span class="mdr">{% translate "Payment Description" %}</span>
                            <div class="input-area">
                                <input class="xxlr" onkeyup="CalculateBalance()" placeholder="{% translate 'Payment for fees' %}" type="text" name="description">
                                
                            </div>
                        </div>

                        <!-- js -->
                        <script>
                            function CalculateBalance(){
                                let available_balance = "{{ request.user.account.account_balance }}" // get user account balance
                                let new_balance = document.getElementById("new_balance")
                                let sendAmount_input = document.getElementById("amount_send")
                                let sendAmount = sendAmount_input.value
                                let errorDive = document.getElementById("error-div")
                                let total_to_pay = document.getElementById("total-to-pay")

                                let errors = []

                                new_bal = available_balance - sendAmount
                                console.log(new_bal);

                                // new_balance.innerHTML = `New Balance $${new_bal.toString().replace(/\B(?))}`;
                                new_balance.innerHTML = `<b style='font-size: 18px; font-weight: 400; color: var(--para-color);'>{% translate "New Balance" %}</b> <b style='font-size: 18px; font-weight: 500;'> $${new_bal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} </b>`;
                                total_to_pay.innerHTML = `USD <b> $${sendAmount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} </b>`;

                                if (new_bal < 0){
                                    new_balance.style.color = "red"
                                    alert("You can only send $" + available_balance.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","))
                                } else {
                                    new_balance.style.color = "#27276e"

                                }
                            }
                        </script>
                        <ul class="total-fees">
                            
                        </ul>
                        <ul class="total-fees pay">
                            <li>
                                <h5>{% translate "Total To Pay" %}</h5>
                            </li>
                            <li>
                                <h5 id="total-to-pay">$ 0.00</h5>
                            </li>
                        </ul>
                        <div class="footer-area mt-40">
                            <a href="pay-step-1.html">{% translate "Previous Step" %}</a>
                            <button type="submit" style="padding: 10px 30px; border-radius: 10px; background: rgb(98, 0, 255); color: #fff;" class="active">{% translate "Next" %}</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
    <!-- Dashboard Section end -->
{% endblock content %}
